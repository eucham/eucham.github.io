<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>一条肥鱼</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="一条肥鱼"><meta name="msapplication-TileImage" content="/images/pics/d261cdb6203e0da42ae1324dd3aae11f.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="一条肥鱼"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta description="No. I&amp;#39;ll bring me back a souvenir."><meta property="og:type" content="website"><meta property="og:title" content="一条肥鱼"><meta property="og:url" content="https://feiyu.dev/"><meta property="og:site_name" content="一条肥鱼"><meta property="og:description" content="No. I&amp;#39;ll bring me back a souvenir."><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://feiyu.dev/img/og_image.png"><meta property="article:author" content="一条肥鱼"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://feiyu.dev"},"headline":"一条肥鱼","image":["https://feiyu.dev/img/og_image.png"],"author":{"@type":"Person","name":"一条肥鱼"},"description":"No. I&#39;ll bring me back a souvenir."}</script><link rel="icon" href="/images/pics/d261cdb6203e0da42ae1324dd3aae11f.png"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?7d79380bb26079f6dd33da78e83cf2ab";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><meta name="generator" content="Hexo 5.2.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/images/pics/d261cdb6203e0da42ae1324dd3aae11f.png" alt="一条肥鱼" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/categories/Golang">Golang</a><a class="navbar-item" href="/categories/Kubernetes">Kubernetes</a><a class="navbar-item" href="/categories/Docker">Docker</a><a class="navbar-item" href="/about.html">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="To Find Me" href="https://github.com/feiyudev"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-09-05T07:27:30.000Z" title="2020-09-05T07:27:30.000Z">2020-09-05</time>发表</span><span class="level-item"><time dateTime="2021-12-31T07:31:15.596Z" title="2021-12-31T07:31:15.596Z">2021-12-31</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a></span><span class="level-item">35 分钟读完 (大约5186个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/09/05/795d32ee2085.html">折腾自建博客系列</a></h1><div class="content">今年年初由 wordpress 迁移到 halo，主要是觉得懂点 Java，有什么定制化的需求，自己改代码会方便一些。但是也没有什么特别的需求需要定制，反而被这种东西折腾得忘记了写博客的初心。技术博客就应该简简单单，只写技术，博客怎么好看、怎么炫酷，都不重要。配置说明&amp;前置条件在 Halo </div><a class="article-more button is-small is-size-7" href="/2020/09/05/795d32ee2085.html#more">阅读更多</a></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-08-20T08:27:30.000Z" title="2020-08-20T08:27:30.000Z">2020-08-20</time>发表</span><span class="level-item"><time dateTime="2021-02-09T03:03:26.827Z" title="2021-02-09T03:03:26.827Z">2021-02-09</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Golang/">Golang</a></span><span class="level-item">12 分钟读完 (大约1789个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/08/20/cfc39c70ed62.html">0 | Golang：基础构建工具使用</a></h1><div class="content"><p>Golang 里面有一堆看起来很高大上的名词，以及一些自带的工具链。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install golang</span><br></pre></td></tr></table></figure>
<p>安装完之后，有一堆默认的配置信息，可以通过 <code>go env</code> 来进行查看：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">╰─$ go env</span><br><span class="line">GO111MODULE=&quot;&quot;</span><br><span class="line">GOARCH=&quot;amd64&quot;</span><br><span class="line">GOBIN=&quot;&quot;</span><br><span class="line">GOCACHE=&quot;/Users/akina/Library/Caches/go-build&quot;</span><br><span class="line">GOENV=&quot;/Users/akina/Library/Application Support/go/env&quot;</span><br><span class="line">GOEXE=&quot;&quot;</span><br><span class="line">GOFLAGS=&quot;&quot;</span><br><span class="line">GOHOSTARCH=&quot;amd64&quot;</span><br><span class="line">GOHOSTOS=&quot;darwin&quot;</span><br><span class="line">GOINSECURE=&quot;&quot;</span><br><span class="line">GONOPROXY=&quot;&quot;</span><br><span class="line">GONOSUMDB=&quot;&quot;</span><br><span class="line">GOOS=&quot;darwin&quot;</span><br><span class="line">GOPATH=&quot;/Users/akina/go&quot;</span><br><span class="line">GOPRIVATE=&quot;&quot;</span><br><span class="line">GOPROXY=&quot;https://proxy.golang.org,direct&quot;</span><br><span class="line">GOROOT=&quot;/usr/local/Cellar/go/1.14.6/libexec&quot;</span><br><span class="line">GOSUMDB=&quot;sum.golang.org&quot;</span><br><span class="line">GOTMPDIR=&quot;&quot;</span><br><span class="line">GOTOOLDIR=&quot;/usr/local/Cellar/go/1.14.6/libexec/pkg/tool/darwin_amd64&quot;</span><br><span class="line">GCCGO=&quot;gccgo&quot;</span><br><span class="line">AR=&quot;ar&quot;</span><br><span class="line">CC=&quot;clang&quot;</span><br><span class="line">CXX=&quot;clang++&quot;</span><br><span class="line">CGO_ENABLED=&quot;1&quot;</span><br><span class="line">GOMOD=&quot;&quot;</span><br><span class="line">CGO_CFLAGS=&quot;-g -O2&quot;</span><br><span class="line">CGO_CPPFLAGS=&quot;&quot;</span><br><span class="line">CGO_CXXFLAGS=&quot;-g -O2&quot;</span><br><span class="line">CGO_FFLAGS=&quot;-g -O2&quot;</span><br><span class="line">CGO_LDFLAGS=&quot;-g -O2&quot;</span><br><span class="line">PKG_CONFIG=&quot;pkg-config&quot;</span><br><span class="line">GOGCCFLAGS=&quot;-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fdebug-prefix-map=/var/folders/km/t6kk56y13ns2yf91lwq58gbh0000gn/T/go-build924722399=/tmp/go-build -gno-record-gcc-switches -fno-common&quot;</span><br></pre></td></tr></table></figure>
<p>其中有几个比较重要的变量，需要注意。</p>
<h2 id="GOROOT"><a href="#GOROOT" class="headerlink" title="GOROOT"></a>GOROOT</h2><p>Golang 的安装目录。本机上的 GOROOT 为：<code>/usr/local/Cellar/go/1.14.6/libexec</code>，它的目录结构如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">╰─$ tree -L 1 /usr/local/Cellar/go/1.14.6/libexec</span><br><span class="line">/usr/local/Cellar/go/1.14.6/libexec</span><br><span class="line">├── CONTRIBUTING.md</span><br><span class="line">├── CONTRIBUTORS</span><br><span class="line">├── PATENTS</span><br><span class="line">├── SECURITY.md</span><br><span class="line">├── VERSION</span><br><span class="line">├── api</span><br><span class="line">├── bin</span><br><span class="line">├── doc</span><br><span class="line">├── favicon.ico</span><br><span class="line">├── lib</span><br><span class="line">├── misc</span><br><span class="line">├── pkg</span><br><span class="line">├── robots.txt</span><br><span class="line">├── src</span><br><span class="line">└── test</span><br></pre></td></tr></table></figure>

<h2 id="GOPATH"><a href="#GOPATH" class="headerlink" title="GOPATH"></a>GOPATH</h2><p>同样是一个变量，且变量值的内容是一个目录，那 Golang 拿着这个变量来做什么呢？它的作用用文字说明可能比较苍白无力、甚至有点抽象，用亲手实践来看看它到底有什么用处。在本机中，GOPATH 的值（默认值：<code>$HOME/go</code>）为：<code>/Users/akina/go</code>。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">╰─$ tree -L 1 /Users/akina/go</span><br><span class="line">/Users/akina/go</span><br><span class="line">├── bin</span><br><span class="line">├── pkg</span><br><span class="line">└── src</span><br></pre></td></tr></table></figure>
<p>其中会自动生成三个文件夹，它们的作用分别为：<br>|文件夹|作用|<br>|——-|——-|<br>|bin|golang 编译可执行文件存放路径，可自动生成。|<br>|pkg|golang编译的.a中间文件存放路径，可自动生成。|<br>|src|源码路径。按照golang默认约定，go run，go install等命令的当前工作路径（即在此路径下执行上述命令）|</p>
<p>暂时将其视为一个普通的目录，拥有三个普通的文件夹。先看后面的 <code>go build</code>、<code>go install</code>、<code>go run</code>。</p>
<h2 id="GOBIN"><a href="#GOBIN" class="headerlink" title="GOBIN"></a>GOBIN</h2><p>go install 编译存放路径。为空时则遵循“约定优于配置”原则，可执行文件放在各自 GOPATH 目录的 bin 文件夹中，即 <code>$GOPATH/bin</code>。</p>
<p>有两种情况下，bin 目录会变得没有意义。</p>
<ul>
<li>当设置了有效的 GOBIN 环境变量以后，bin 目录就变得没有意义。</li>
<li>如果 GOPATH 里面包含多个工作区路径的时候，必须设置 GOBIN 环境变量，否则就无法安装 Go 程序的可执行文件。</li>
</ul>
<h2 id="GOPROXY"><a href="#GOPROXY" class="headerlink" title="GOPROXY"></a>GOPROXY</h2><p>如果遇到下载不下来包的情况，可以考虑尝试设置 GOPROXY 。如下（&gt;=1.13）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">go env -w GO111MODULE=on</span><br><span class="line">go env -w GOPROXY=https://goproxy.io,direct</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置不走 proxy 的私有仓库，多个用逗号相隔（可选）</span></span><br><span class="line">go env -w GOPRIVATE=*.corp.example.com</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置不走 proxy 的私有组织（可选）</span></span><br><span class="line">go env -w GOPRIVATE=example.com/org_name</span><br></pre></td></tr></table></figure>

<h2 id="go-build"><a href="#go-build" class="headerlink" title="go build"></a>go build</h2><p>usage: go build [-o output] [-i] [build flags] [packages]</p>
<blockquote>
<p>Build compiles the packages named by the <strong>import paths</strong>, along with their dependencies, but it does not install the results.</p>
<p>If the arguments to build are a list of .go files from a single directory, build treats them as a list of source files specifying a single package.</p>
<p>When compiling packages, build ignores files that end in ‘_test.go’.</p>
<p>When compiling a single main package, build writes the resulting executable to an output file named after the first source file (‘go build ed.go rx.go’ writes ‘ed’ or ‘ed.exe’) or the source code directory (‘go build unix/sam’ writes ‘sam’ or ‘sam.exe’).</p>
<p>The ‘.exe’ suffix is added when writing a Windows executable.</p>
<p>When compiling multiple packages or a single non-main package, build compiles the packages but discards the resulting object, serving only as a check that the packages can be built.</p>
</blockquote>
<ul>
<li><code>go build</code> 命令默认编译当前目录下的所有 go 文件</li>
<li><code>go build a.go</code> 只编译 a.go 文件<br><img src="/images/pics/5ecb65d7afd25c0e2d2995bc33cc640a.png" alt="缺省编译 &amp; 编译某个文件"><br>如果将编译对象换成不含有 main 函数的代码，没有任何输出<br><img src="/images/pics/61fe093196090faa774fddecf7c0316a.png" alt="编译 non-main 代码"></li>
<li><code>go build IMPORT-PATH</code> 编译在 <code>$GOPATH/src</code> 下面的 <code>IMPORT-PATH</code> 包，并在当前目录 （pwd）下，生成可执行文件（对含有 main 函数的代码来说）<br><img src="/images/pics/daabf112e15b7f1ef3f9b6e4a94c6b08.png" alt="编译 GOPATH 下的包"></li>
</ul>
<h2 id="go-install"><a href="#go-install" class="headerlink" title="go install"></a>go install</h2><p>它在 <code>go build</code> 的基础上，将编译后的<strong>可执行文件</strong>或<strong>中间文件</strong>，移动到 $GOPATH 的 bin 或 pkg 目录下。</p>
<p><img src="/images/pics/94a41681190f4614f58e17c0c81d3556.png" alt="install"></p>
<h2 id="go-run"><a href="#go-run" class="headerlink" title="go run"></a>go run</h2><p>类似于 <code>go build</code>，可以在其它目录，仅指定在 $GOPATH 下的包名，即可运行该包内容；也可以指定一个含有 main 函数的文件。如下：</p>
<p><img src="/images/pics/6b1ca443224dc7ea0be5777676c5fb0c.png" alt="run"></p>
<h2 id="go-get"><a href="#go-get" class="headerlink" title="go get"></a>go get</h2><p>用于从远程代码仓库（比如 Github 等 ）上<strong>下载并安装</strong>代码包。下载源码包的go工具会自动根据不同的域名调用不同的源码工具，对应关系如下：<br>|仓库|源码工具|<br>|——-|——-|<br>|BitBucket|Mercurial Git|<br>|GitHub|Git|<br>|Google Code Project Hosting|Git, Mercurial, Subversion|<br>|Launchpad|Bazaar|</p>
<p>它会把当前的代码包下载到 $GOPATH 中的第一个工作区的 src 目录中，并安装。</p>
<ul>
<li><code>-d</code>：只下载不安装</li>
<li><code>-u</code>：更新已下载的代码包</li>
</ul>
<p><img src="/images/pics/35b1b019be8fd8dbabcbf27ada41e646.png" alt="执行 go get 后所安装的内容"></p>
<p>GoLand 中打开的 terminal 会自动将 $GOPATH/bin 添加到 PATH 变量中，导致在 GoLand 的 terminal 上可以使用通过 go get 安装的命令，在 iTerm2 上面就不行。只要在 .bashrc/.zshrc 中，将 $GOPATH/bin 添加到 PATH 变量中就可以在 iTerm2 中使用。</p>
<h2 id="go-fmt"><a href="#go-fmt" class="headerlink" title="go fmt"></a>go fmt</h2><p>将代码整理成 Golang 风格。</p>
<p>usage: go fmt [-n] [-x] [packages]</p>
<blockquote>
<p>Fmt runs the command ‘gofmt -l -w’ on the packages named by the import paths. It prints the names of the files that are modified.</p>
<p>For more about gofmt, see ‘go doc cmd/gofmt’.<br>For more about specifying packages, see ‘go help packages’.</p>
<p>The -n flag <strong>prints commands that would be executed</strong>.<br>The -x flag <strong>prints commands as they are executed</strong>.</p>
<p>The -mod flag’s value sets which module download mode to use: readonly or vendor. See ‘go help modules’ for more.</p>
<p>To run gofmt with specific options, run gofmt itself.</p>
</blockquote>
<p>go fmt 实际调用的是 <code>gofmt -l -w</code>，而 gofmt 的使用如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">usage: gofmt [flags] [path ...]</span><br><span class="line">  -cpuprofile string</span><br><span class="line">    	write cpu profile to this file</span><br><span class="line">  -d	display diffs instead of rewriting files</span><br><span class="line">  -e	report all errors (not just the first 10 on different lines)</span><br><span class="line">  -l	list files whose formatting differs from gofmt&#x27;s</span><br><span class="line">  -r string</span><br><span class="line">    	rewrite rule (e.g., &#x27;a[b:len(a)] -&gt; a[b:]&#x27;)</span><br><span class="line">  -s	simplify code</span><br><span class="line">  -w	write result to (source) file instead of stdout</span><br></pre></td></tr></table></figure>
<p>gofmt 与 go 在同一级目录，都在 <code>$GOROOT/bin</code> 下：<br><img src="/images/pics/bf67cdf5d11c58a33b8a51fb17fbf8a1.png"><br>看看效果：</p>
<p>初始样式</p>
<p><img src="/images/pics/070bcdbe0948e2f0ae444d3074d49f8c.png" alt="Before go fmt"></p>
<p>执行 go fmt，可以明显看出，代码变整齐了。</p>
<p><img src="/images/pics/c3868946c108b2480ce2610273190b45.png"></p>
<h2 id="go-test"><a href="#go-test" class="headerlink" title="go test"></a>go test</h2><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a target="_blank" rel="noopener" href="https://halfrost.com/go_command/">https://halfrost.com/go_command/</a></li>
<li><a target="_blank" rel="noopener" href="https://astaxie.gitbooks.io/build-web-application-with-golang/content/zh/01.3.html">https://astaxie.gitbooks.io/build-web-application-with-golang/content/zh/01.3.html</a></li>
<li><a target="_blank" rel="noopener" href="https://goproxy.io/zh/">https://goproxy.io/zh/</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-08-18T06:08:25.000Z" title="2020-08-18T06:08:25.000Z">2020-08-18</time>发表</span><span class="level-item"><time dateTime="2022-04-20T16:35:49.898Z" title="2022-04-20T16:35:49.898Z">2022-04-21</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Linux/">Linux</a></span><span class="level-item">几秒读完 (大约57个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/08/18/763356a713b2.html">Linux修改hostname和用户名</a></h1><div class="content">ReferenceSSH允许root远程登录Linux：修改HostnameLinux 下如何修改用户名（同时修改用户组名和家目录）</div><a class="article-more button is-small is-size-7" href="/2020/08/18/763356a713b2.html#more">阅读更多</a></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-08-16T15:05:41.000Z" title="2020-08-16T15:05:41.000Z">2020-08-16</time>发表</span><span class="level-item"><time dateTime="2021-12-31T07:58:37.786Z" title="2021-12-31T07:58:37.786Z">2021-12-31</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Kubernetes/">Kubernetes</a></span><span class="level-item">20 分钟读完 (大约3028个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/08/16/b84b0ed4d8b2.html">1.2 | Kubernetes：容器技术</a></h1><div class="content">此文是一篇大杂烩，记录一些对我很有用处的新知识。主要包括容器相关概念、实现原理、相关标准等。最大的感触就是 Golang 才是云时代的语言，很多容器相关软件的开发语言是用的 Golang。Let's go!什么是容器容器就是将软件打包成标准化单元，以用于开发、交付和部署。简单说就是：容器可以被当做一</div><a class="article-more button is-small is-size-7" href="/2020/08/16/b84b0ed4d8b2.html#more">阅读更多</a></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-08-16T06:46:44.000Z" title="2020-08-16T06:46:44.000Z">2020-08-16</time>发表</span><span class="level-item"><time dateTime="2022-04-20T15:46:32.532Z" title="2022-04-20T15:46:32.532Z">2022-04-20</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Kubernetes/">Kubernetes</a></span><span class="level-item">3 分钟读完 (大约456个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/08/16/6658589810ed.html">1.1 |  kubernetes: 是什么和为什么</a></h1><div class="content">WHAT of kubernetes一套基于容器技术的分布式架构方案。基于 Google 的 Borg（内部使用超过10年） 系统实现资源管理的自动化、资源利用的最大化使用 kubernetes 可以减少开发成本（如服务治理、服务监控、故障处理等），将精力投入到业务开发中。开放平台，不限编程语言，模</div><a class="article-more button is-small is-size-7" href="/2020/08/16/6658589810ed.html#more">阅读更多</a></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-08-02T16:22:35.000Z" title="2020-08-02T16:22:35.000Z">2020-08-03</time>发表</span><span class="level-item"><time dateTime="2022-04-20T16:23:18.976Z" title="2022-04-20T16:23:18.976Z">2022-04-21</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Spring%E7%B3%BB%E5%88%97/">Spring系列</a></span><span class="level-item">几秒读完 (大约25个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/08/03/1ccace6d1c44.html">1 | SpringBoot：配置文件的加载顺序</a></h1><div class="content">SpringBoot 官方文档说明</div><a class="article-more button is-small is-size-7" href="/2020/08/03/1ccace6d1c44.html#more">阅读更多</a></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-08-02T16:10:07.000Z" title="2020-08-02T16:10:07.000Z">2020-08-03</time>发表</span><span class="level-item"><time dateTime="2022-04-20T16:09:32.658Z" title="2022-04-20T16:09:32.658Z">2022-04-21</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Golang/">Golang</a></span><span class="level-item">10 分钟读完 (大约1480个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/08/03/fb9b4d686ed9.html">Golang：半个月从入门到辞退?</a></h1><div class="content">这不是标题党，这是一份学习笔记，记录遇到的问题，包括但不仅仅限于 golang 的语法格式、常用用法、神奇操作等。Update: 本以为一篇长文就可以搞定这个入门到辞退，感觉东西好多啊，还是分开多篇吧。关键字func编译报错，返回值要么都有名，要么都没有名称。func funcMui(x, y in</div><a class="article-more button is-small is-size-7" href="/2020/08/03/fb9b4d686ed9.html#more">阅读更多</a></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-08-02T15:55:05.000Z" title="2020-08-02T15:55:05.000Z">2020-08-02</time>发表</span><span class="level-item"><time dateTime="2021-02-09T03:03:52.434Z" title="2021-02-09T03:03:52.434Z">2021-02-09</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Kubernetes/">Kubernetes</a></span><span class="level-item">5 分钟读完 (大约810个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/08/02/d33b9db7e790.html">0 | kubernetes：学习路线导览与记录</a></h1><div class="content"><blockquote>
<p>在之前的后端开发中，多多少少接触过一些 kubernetes 的内容，但是并未深入了解，在接触到 golang 编程以及 CD 发布系统的情形下，知道了 kubernetes 的强大之后，便开始找机会系统了解 kubernetes，因此了解 kubernetes 是一种不可多得的提升自我的方式，不论是从工作上、还是自我提升。</p>
</blockquote>
<p>本文路线主要参照<a target="_blank" rel="noopener" href="https://github.com/caicloud/kube-ladder">此教程</a>给出的建议，记录遇到的问题以及对 kubernetes 的认识。</p>
<p><a target="_blank" rel="noopener" href="https://kubernetes.io/">https://kubernetes.io/</a></p>
<h2 id="8月第一周"><a href="#8月第一周" class="headerlink" title="8月第一周"></a>8月第一周</h2><p>本周目标</p>
<ul>
<li>Kubernetes 的背景</li>
<li>安装 Kubernetes 环境</li>
<li>Kubernetes 基本概念和使用方法</li>
</ul>
<h3 id="为什么会出现-kubernetes"><a href="#为什么会出现-kubernetes" class="headerlink" title="为什么会出现 kubernetes"></a>为什么会出现 kubernetes</h3><p>学习任何系统的之前，了解其出现的背景和意义都是必不可少的，为什么会出现 Kubernetes？它解决了什么问题？有没有其他类似的系统？这里推荐阅读才云科技 CEO 张鑫在 2017 年文章《<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/hrgXzt7YKVf6ZCFzJ-WTFA">从风口浪尖到十字路口，写在 Kubernetes 两周年之际</a>》。</p>
<h3 id="以简易方式安装-kubernetes"><a href="#以简易方式安装-kubernetes" class="headerlink" title="以简易方式安装 kubernetes"></a>以简易方式安装 kubernetes</h3><p>推荐使用 <a target="_blank" rel="noopener" href="https://github.com/kubernetes/minikube">minikube</a> 或 <a target="_blank" rel="noopener" href="https://github.com/kubernetes-sigs/kind">kind</a> 部署一个本地环境，然后开始部署一个”真实”的应用（minikube 安装需要使用科学上网，或使用<a target="_blank" rel="noopener" href="https://yq.aliyun.com/articles/221687">“国内版” minikube</a>）。如果想一开始就挑战更高难度的安装方式（不推荐），可以使用 <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/">kubeadm</a> 或者手动部署所有组件。关于安装，可以参考文档 <a target="_blank" rel="noopener" href="https://github.com/caicloud/kube-ladder/blob/master/tutorials/lab1-installation.md">lab1-installation</a>。</p>
<h3 id="kubernetes-资源与概念"><a href="#kubernetes-资源与概念" class="headerlink" title="kubernetes 资源与概念"></a>kubernetes 资源与概念</h3><p>推荐熟练使用以下常用资源和概念：Pod、Node、Label、Event、Service、Configmap &amp; Secret、Deployment、Namespace。相关学习可以参考文档 <a target="_blank" rel="noopener" href="https://github.com/caicloud/kube-ladder/blob/master/tutorials/lab2-application-and-service.md">lab2-application-and-service</a>。</p>
<p>（可选）仅完成上述内容可能还不足以让我们非常熟悉 Kubernetes 的基本概念，下面列出其他可以参考的资料，大家也可以按照自己的方式去搜索相关的资料：</p>
<ul>
<li>官方 Tutorial：<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/tutorials/kubernetes-basics/">Learn Kubernetes Basics</a></li>
<li>官方 Guestbook 样例：<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/tutorials/stateless-application/guestbook/">Guestbook Example</a></li>
</ul>
<h3 id="预期达到效果"><a href="#预期达到效果" class="headerlink" title="预期达到效果"></a>预期达到效果</h3><ul>
<li>反复加深对上面资源的操作熟练度。如果你是第一次接触 Kubernetes，或者仅了解过一点 Kubernetes 的知识，那么基（ken）本（ding）是不明白 Kubernetes 底层到底发生了什么。请不要心急，姑且把它当成一个黑盒工具即可 ?。</li>
<li>你可能会在网上看到更多的概念，如 PVC、Ingress、Priority 等。炼气阶段，请不要尝试学习过多的资源类型。Kubernetes 有非常多的概念和类似的资源，我们这里熟悉最核心的概念即可，否则易走火入魔 ?，切记。当我们打通任督二脉之时，所有的新概念都不过尔尔。</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-07-30T12:36:46.000Z" title="2020-07-30T12:36:46.000Z">2020-07-30</time>发表</span><span class="level-item"><time dateTime="2022-04-20T15:47:12.294Z" title="2022-04-20T15:47:12.294Z">2022-04-20</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Spinnaker/">Spinnaker</a></span><span class="level-item">19 分钟读完 (大约2819个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/07/30/20d4d0eeb1ae.html">1 | Spinnaker: Agent 缓存云厂商各项数据流程分析</a></h1><div class="content">在 clouddriver 中缓存云厂商的各项数据，是由这些 agent 所来完成。本文主要聚焦于何时执行、如何存储、以及存储后如何使用这三点上。Agent 从哪里来创建 agent为每个云账号的每个区域创建10个不同类型的 agent安排启动ProviderUtils.rescheduleAgen</div><a class="article-more button is-small is-size-7" href="/2020/07/30/20d4d0eeb1ae.html#more">阅读更多</a></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-07-29T17:28:49.000Z" title="2020-07-29T17:28:49.000Z">2020-07-30</time>发表</span><span class="level-item"><time dateTime="2021-02-09T03:03:03.425Z" title="2021-02-09T03:03:03.425Z">2021-02-09</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/">中间件</a></span><span class="level-item">8 分钟读完 (大约1251个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/07/30/3f3a2e801ffb.html">1 | Dubbo：探讨标签路由的实现</a></h1><div class="content"><blockquote>
<p>项目需要，对 Dubbo 进行了一次功能调研，主要集中在服务治理中的标签路由。这部分的内容不难，但是能够对 Dubbo 的实现有一定的了解。</p>
</blockquote>
<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><p>需要 ZooKeeper、Java Application Based on Dubbo。</p>
<h3 id="ZooKeeper-的搭建"><a href="#ZooKeeper-的搭建" class="headerlink" title="ZooKeeper 的搭建"></a>ZooKeeper 的搭建</h3><p>通过 CODING CD，在腾讯云的弹性伸缩组上（有兴趣可到 CODING CD 中详细了解），部署的一个实例，需要先安装 java 依赖，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java-1.8.0-openjdk-devel.x86_64</span><br></pre></td></tr></table></figure>
<p>其主要的配置是一个脚本，如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">wget http://mirrors.hust.edu.cn/apache/zookeeper/zookeeper-3.6.1/apache-zookeeper-3.6.1-bin.tar.gz</span><br><span class="line">tar -xzvf apache-zookeeper-3.6.1-bin.tar.gz</span><br><span class="line">mv apache-zookeeper-3.6.1-bin zk</span><br><span class="line">mv zk/conf/zoo_sample.cfg zk/conf/zoo.cfg</span><br><span class="line"></span><br><span class="line">echo &#x27;&#x27;&#x27;[Unit]</span><br><span class="line">Description=ZooKeeper for Dubbo </span><br><span class="line">After=network.target</span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/bin/sh /root/zk/bin/zkServer.sh start</span><br><span class="line">ExecStop=/bin/sh /root/zk/bin/zkServer.sh stop</span><br><span class="line">User=root</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target &#x27;&#x27;&#x27; &gt; /usr/lib/systemd/system/zk-for-dubbo.service</span><br><span class="line">systemctl enable zk-for-dubbo</span><br></pre></td></tr></table></figure>
<p>在安全组中确保端口 2181 开放。此时：</p>
<ul>
<li>公网 IP 为 49.233.238.170</li>
<li>内网 IP 为 172.21.0.34</li>
</ul>
<h3 id="Java-Application-Based-on-Dubbo"><a href="#Java-Application-Based-on-Dubbo" class="headerlink" title="Java Application Based on Dubbo"></a>Java Application Based on Dubbo</h3><p>A 模块在调用 B 模块前，设置了一个 TAG_KEY，表示选择带有 TAG_KEY 的 B 服务：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Reference</span></span><br><span class="line"><span class="keyword">private</span> DoSomeThingService doSomeThingService;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    RpcContext.getContext().setAttachment(CommonConstants.TAG_KEY, <span class="string">&quot;tag1&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> doSomeThingService.sayHello();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>应用的部署还是采用 CODING CD 部署在腾讯云的弹性伸缩组上。主要的配置如下：</p>
<p>A 模块启动：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar -Ddubbo.registry.address=zookeeper://172.21.0.34:2181 /root/a.jar 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>

<p>B 模块启动：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar -Ddubbo.registry.address=zookeeper://172.21.0.34:2181 /root/b.jar 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>

<h3 id="Dubbo-admin-安装与配置"><a href="#Dubbo-admin-安装与配置" class="headerlink" title="Dubbo admin 安装与配置"></a>Dubbo admin 安装与配置</h3><p>dubbo-admin 使用的 github 中 develop 的最新版，按照相应的提示进行构建即可。</p>
<p><strong>启动 dubbo-admin 的前端</strong>，此时的目录为 <code>dubbo-admin/dubbo-admin-ui</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run dev</span><br></pre></td></tr></table></figure>

<p><strong>启动 dubbo-admin 的后端</strong>，此时的目录为 <code>dubbo-admin/dubbo-admin-server</code></p>
<p>修改 <code>dubbo-admin/dubbo-admin-server/src/main/resources/application.properties</code> 文件，改成正确的 zookeeper 地址。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">admin.registry.address=zookeeper://49.233.238.170:2181</span><br><span class="line">admin.config-center=zookeeper://49.233.238.170:2181</span><br><span class="line">admin.metadata-report.address=zookeeper://49.233.238.170:2181</span><br></pre></td></tr></table></figure>

<p>编译并启动</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mvn clean package -DskipTests=true</span><br><span class="line">cd target</span><br><span class="line">java -jar dubbo-admin-server-0.2.0-SNAPSHOT.jar</span><br></pre></td></tr></table></figure>

<p>打开 dubbo-admin，找到标签路由，配置如下，应用名填写 moduleb：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">force:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">runtime:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">tags:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tag1</span></span><br><span class="line">    <span class="attr">addresses:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;172.21.0.40:20880&#x27;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tag2</span></span><br><span class="line">    <span class="attr">addresses:</span> <span class="literal">null</span></span><br></pre></td></tr></table></figure>

<p><strong>TIPS</strong><br>如果有遇到在 Dubbo Admin 中修改不生效的情况，考虑一下 Dubbo Admin 与 Dubbo 版本间的差异。在此踩到一个坑如下：</p>
<blockquote>
<p>Dubbo Admin 管理页面是用 docker 跑起来的，它里面的源代码比较旧，路由设置到 zk 中的路径与 dubbo 读取 zk 的路径不一样。ISSUE 可见：<a target="_blank" rel="noopener" href="https://github.com/apache/dubbo-admin/issues/577">https://github.com/apache/dubbo-admin/issues/577</a></p>
</blockquote>
<h2 id="效果展示"><a href="#效果展示" class="headerlink" title="效果展示"></a>效果展示</h2><p>请求流向：LB -&gt; A -&gt; B</p>
<p>A 中设置的 TAG_KEY 为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    RpcContext.getContext().setAttachment(CommonConstants.TAG_KEY, <span class="string">&quot;tag1&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> doSomeThingService.sayHello();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时 B 模块服务有两个，即一个新、一个旧。<br><img src="/images/pics/12b910d715dc49c2cfca5585fde0acb0.png"></p>
<p>如果要只返回最新版本，可在 dubbo-admin 控制台的服务治理中，添加标签路由，新的实例在 tag1 下，旧的实例在 tag2 下，如下：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">force:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">runtime:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">tags:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tag1</span></span><br><span class="line">    <span class="attr">addresses:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;172.21.0.21:20880&#x27;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tag2</span></span><br><span class="line">    <span class="attr">addresses:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;172.21.0.40:20880&#x27;</span></span><br></pre></td></tr></table></figure>
<p>此时的返回如下：<br><img src="/images/pics/013ff5ce7d84286fe8ac10c32295c4ef.png"></p>
<p>如果只使用旧版本实例，可在将上面 tag1 和 tag2 下面的内容调换即可，此时返回如下：<br><img src="/images/pics/e6c13de09f55730506fcbfe80dc533f2.png"></p>
<p>如果要同时能够访问到新旧实例的内容，将上述配置中所有的 IP 全部填写到 tag1 下即可，此时的返回如下：<br><img src="/images/pics/e2c4eda7451ca8c39b98b5a119ef4b79.png" alt="image"></p>
<h2 id="Dubbo-标签路由的实现原理"><a href="#Dubbo-标签路由的实现原理" class="headerlink" title="Dubbo 标签路由的实现原理"></a>Dubbo 标签路由的实现原理</h2><p>总共分三个大的方面，分别是配置的存储、配置同步、如何解析配置。</p>
<h3 id="标签路由配置的存储"><a href="#标签路由配置的存储" class="headerlink" title="标签路由配置的存储"></a>标签路由配置的存储</h3><p>URL: /api/dev/rules/route/tag/moduleb<br>Request Method: PUT</p>
<p>在 dubbo-admin-server 中它的实现在文件 <code>TagRoutesController.java</code> 中，最终是将配置保存到 ZooKeeper 中，保存的路径为：<br><img src="/images/pics/2de0244f29a6f00f3660e09443445ab6.png"></p>
<p>即：/dubbo/config/dubbo/moduleb.tag-router</p>
<p>在 ZooKeeper 中可以在相应的路径下看到相关的配置，如下：<br><img src="/images/pics/c3751e24d0c64f334c8e77eb583e84e9.png"></p>
<h3 id="配置变更同步"><a href="#配置变更同步" class="headerlink" title="配置变更同步"></a>配置变更同步</h3><p>在 <code>TagRouter.java</code> 中实现了 <code>ConfigurationListener</code> 接口，当配置变更时，会更新 <code>tagRouterRule</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(ConfigChangedEvent event)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">        logger.debug(<span class="string">&quot;Notification of tag rule, change type is: &quot;</span> + event.getChangeType() + <span class="string">&quot;, raw rule is:\n &quot;</span> +</span><br><span class="line">                event.getContent());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (event.getChangeType().equals(ConfigChangeType.DELETED)) &#123;</span><br><span class="line">            <span class="keyword">this</span>.tagRouterRule = <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.tagRouterRule = TagRuleParser.parse(event.getContent());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        logger.error(<span class="string">&quot;Failed to parse the raw tag router rule and it will not take effect, please check if the &quot;</span> +</span><br><span class="line">                <span class="string">&quot;rule matches with the template, the raw rule is:\n &quot;</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="配置解析"><a href="#配置解析" class="headerlink" title="配置解析"></a>配置解析</h3><p>源码位于 dubbo 中的 <code>TagRouter.java</code><br><img src="/images/pics/792fec3d49a09aac8625760db06fc0a2.png"></p>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>在上面的示例中，我们需要手动在 dubbo-admin 界面中，新增标签路由的配置，但经过对该配置的新增过程的简要分析，发现只是在 ZooKeeper 中新增一条记录。</p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/page/7/">上一页</a></div><div class="pagination-next"><a href="/page/9/">下一页</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/7/">7</a></li><li><a class="pagination-link is-current" href="/page/8/">8</a></li><li><a class="pagination-link" href="/page/9/">9</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/26/">26</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2024/02/"><span class="level-start"><span class="level-item">二月 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/01/"><span class="level-start"><span class="level-item">一月 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/06/"><span class="level-start"><span class="level-item">六月 2023</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/02/"><span class="level-start"><span class="level-item">二月 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/01/"><span class="level-start"><span class="level-item">一月 2023</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/10/"><span class="level-start"><span class="level-item">十月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/08/"><span class="level-start"><span class="level-item">八月 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/07/"><span class="level-start"><span class="level-item">七月 2022</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/06/"><span class="level-start"><span class="level-item">六月 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/05/"><span class="level-start"><span class="level-item">五月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/04/"><span class="level-start"><span class="level-item">四月 2022</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/03/"><span class="level-start"><span class="level-item">三月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/10/"><span class="level-start"><span class="level-item">十月 2021</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/08/"><span class="level-start"><span class="level-item">八月 2021</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/07/"><span class="level-start"><span class="level-item">七月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/06/"><span class="level-start"><span class="level-item">六月 2021</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/05/"><span class="level-start"><span class="level-item">五月 2021</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/04/"><span class="level-start"><span class="level-item">四月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/11/"><span class="level-start"><span class="level-item">十一月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/10/"><span class="level-start"><span class="level-item">十月 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/09/"><span class="level-start"><span class="level-item">九月 2020</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/08/"><span class="level-start"><span class="level-item">八月 2020</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/07/"><span class="level-start"><span class="level-item">七月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/06/"><span class="level-start"><span class="level-item">六月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">五月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/04/"><span class="level-start"><span class="level-item">四月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/03/"><span class="level-start"><span class="level-item">三月 2020</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/02/"><span class="level-start"><span class="level-item">二月 2020</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/01/"><span class="level-start"><span class="level-item">一月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/12/"><span class="level-start"><span class="level-item">十二月 2019</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/11/"><span class="level-start"><span class="level-item">十一月 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/10/"><span class="level-start"><span class="level-item">十月 2019</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/08/"><span class="level-start"><span class="level-item">八月 2019</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/07/"><span class="level-start"><span class="level-item">七月 2019</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/06/"><span class="level-start"><span class="level-item">六月 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/05/"><span class="level-start"><span class="level-item">五月 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/04/"><span class="level-start"><span class="level-item">四月 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/03/"><span class="level-start"><span class="level-item">三月 2019</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/02/"><span class="level-start"><span class="level-item">二月 2019</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/01/"><span class="level-start"><span class="level-item">一月 2019</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/12/"><span class="level-start"><span class="level-item">十二月 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/11/"><span class="level-start"><span class="level-item">十一月 2018</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/09/"><span class="level-start"><span class="level-item">九月 2018</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/08/"><span class="level-start"><span class="level-item">八月 2018</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/07/"><span class="level-start"><span class="level-item">七月 2018</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/06/"><span class="level-start"><span class="level-item">六月 2018</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/05/"><span class="level-start"><span class="level-item">五月 2018</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/04/"><span class="level-start"><span class="level-item">四月 2018</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/03/"><span class="level-start"><span class="level-item">三月 2018</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/02/"><span class="level-start"><span class="level-item">二月 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/01/"><span class="level-start"><span class="level-item">一月 2018</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/12/"><span class="level-start"><span class="level-item">十二月 2017</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/10/"><span class="level-start"><span class="level-item">十月 2017</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/09/"><span class="level-start"><span class="level-item">九月 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/03/"><span class="level-start"><span class="level-item">三月 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/01/"><span class="level-start"><span class="level-item">一月 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/12/"><span class="level-start"><span class="level-item">十二月 2016</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-02-21T02:20:08.000Z">2024-02-21</time></p><p class="title"><a href="/2024/02/21/84ee50d29e8e.html">Google Pixel 7a玩机攻略</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-30T06:39:01.000Z">2024-01-30</time></p><p class="title"><a href="/2024/01/30/64634917304d.html">2024年CKS考试准备</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2023/06/26/dee71ca0ecee.html"><img src="/images/pics/wkhGYG.jpg" alt="利用OpenWrt为虚拟机做流量代理"></a></figure><div class="media-content"><p class="date"><time dateTime="2023-06-26T02:55:51.382Z">2023-06-26</time></p><p class="title"><a href="/2023/06/26/dee71ca0ecee.html">利用OpenWrt为虚拟机做流量代理</a></p><p class="categories"><a href="/categories/%E5%B7%A5%E5%85%B7/">工具</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2023/06/12/916fff7d458d.html"><img src="/images/pics/b00a1e01142bcaeee115eaab5848ce85.jpg" alt="Git 操作及原理"></a></figure><div class="media-content"><p class="date"><time dateTime="2023-06-12T07:12:22.446Z">2023-06-12</time></p><p class="title"><a href="/2023/06/12/916fff7d458d.html">Git 操作及原理</a></p><p class="categories"><a href="/categories/%E5%B7%A5%E5%85%B7/">工具</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2023/06/12/e54d04dcd0b8.html"><img src="/images/pics/Sd0C2u.jpg" alt="换行符问题"></a></figure><div class="media-content"><p class="date"><time dateTime="2023-06-12T07:08:08.170Z">2023-06-12</time></p><p class="title"><a href="/2023/06/12/e54d04dcd0b8.html">换行符问题</a></p><p class="categories"><a href="/categories/%E5%B7%A5%E5%85%B7/">工具</a></p></div></article></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://crisfang.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Cris</span></span><span class="level-right"><span class="level-item tag">crisfang.com</span></span></a></li><li><a class="level is-mobile" href="https://sanyuesha.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">三月沙</span></span><span class="level-right"><span class="level-item tag">sanyuesha.com</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/images/pics/d261cdb6203e0da42ae1324dd3aae11f.png" alt="一条肥鱼" height="28"></a><p class="is-size-7"><span>&copy; 2024 一条肥鱼</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="To Find Me" href="https://github.com/feiyudev"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" async></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>